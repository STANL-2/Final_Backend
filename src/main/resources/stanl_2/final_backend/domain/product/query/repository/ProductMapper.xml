<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="stanl_2.final_backend.domain.product.query.repository.ProductMapper">

    <resultMap id="productAllResultMap" type="stanl_2.final_backend.domain.product.query.dto.ProductSelectAllDTO">
        <id property="id" column="PROD_ID"/>
        <result property="name" column="PROD_NAME"/>
        <result property="serialNumber" column="PROD_SER_NO"/>
        <result property="cost" column="PROD_COST"/>
        <result property="stock" column="PROD_STCK"/>
    </resultMap>

    <resultMap id="productIdResultMap" type="stanl_2.final_backend.domain.product.query.dto.ProductSelectIdDTO">
        <id property="id" column="PROD_ID"/>
        <result property="name" column="PROD_NAME"/>
        <result property="serialNumber" column="PROD_SER_NO"/>
        <result property="cost" column="PROD_COST"/>
        <result property="stock" column="PROD_STCK"/>
        <result property="country" column="OPT_CNTY"/>
        <result property="manufacturer" column="OPT_MNFR"/>
        <result property="vehicleType" column="OPT_VHC_TYPE"/>
        <result property="chassis" column="OPT_CHSS"/>
        <result property="detailType" column="OPT_DTIL_TYPE"/>
        <result property="bodyType" column="OPT_BODY_TYPE"/>
        <result property="safetyDevice" column="OPT_SFTY_DVCE"/>
        <result property="engineCapacity" column="OPT_ENGN_CPCT"/>
        <result property="secretCode" column="OPT_SCRT_CODE"/>
        <result property="productYear" column="OPT_PRDC_YEAR"/>
        <result property="productPlant" column="OPT_PRDC_PLNT"/>
        <result property="engine" column="OPT_ENGN"/>
        <result property="mission" column="OPT_MSSN"/>
        <result property="trim" column="OPT_TRIM"/>
        <result property="externalColor" column="OPT_XTNL_COLR"/>
        <result property="internalColor" column="OPT_ITNL_COLR"/>
        <result property="headUpDisplay" column="OPT_HUD"/>
        <result property="navigation" column="OPT_NAVI"/>
        <result property="driveWise" column="OPT_DRVE_WISE"/>
        <result property="smartConnect" column="OPT_SMRT_CNCT"/>
        <result property="style" column="OPT_STYL"/>
        <result property="myComfortPackage" column="OPT_MY_CFRT_PCKG"/>
        <result property="outdoorPackage" column="OPT_OTDR_PCKG"/>
        <result property="sunRoof" column="OPT_SUN_ROOF"/>
        <result property="sound" column="OPT_SOND"/>
    </resultMap>


    <select id="findProductById" resultMap="productIdResultMap" parameterType="String">
        SELECT
              A.PROD_ID
            , A.PROD_NAME
            , A.PROD_SER_NO
            , A.PROD_COST
            , A.PROD_STCK
            , B.OPT_CNTY
            , B.OPT_MNFR
            , B.OPT_VHC_TYPE
            , B.OPT_CHSS
            , B.OPT_DTIL_TYPE
            , B.OPT_BODY_TYPE
            , B.OPT_SFTY_DVCE
            , B.OPT_ENGN_CPCT
            , B.OPT_SCRT_CODE
            , B.OPT_PRDC_YEAR
            , B.OPT_PRDC_PLNT
            , B.OPT_ENGN
            , B.OPT_MSSN
            , B.OPT_TRIM
            , B.OPT_XTNL_COLR
            , B.OPT_ITNL_COLR
            , B.OPT_HUD
            , B.OPT_NAVI
            , B.OPT_DRVE_WISE
            , B.OPT_SMRT_CNCT
            , B.OPT_STYL
            , B.OPT_MY_CFRT_PCKG
            , B.OPT_OTDR_PCKG
            , B.OPT_SUN_ROOF
            , B.OPT_SOND
          FROM TB_PRODUCT A
          JOIN TB_PRODUCT_OPTION B on A.PROD_ID = B.PROD_ID
         WHERE A.PROD_ID = #{id} AND A.ACTIVE = TRUE
    </select>

    <select id="findProductBySerialNumber" resultMap="productIdResultMap" parameterType="String">
        SELECT
        A.PROD_ID
        , A.PROD_NAME
        , A.PROD_SER_NO
        , A.PROD_COST
        , A.PROD_STCK
        FROM TB_PRODUCT A
        WHERE A.PROD_SER_NO = #{serialNumber} AND A.ACTIVE = TRUE
    </select>

    <select id="findProductAll" resultMap="productAllResultMap" parameterType="stanl_2.final_backend.domain.product.common.util.RequestList">
        SELECT
              A.PROD_ID
            , A.PROD_NAME
            , A.PROD_SER_NO
            , A.PROD_COST
            , A.PROD_STCK
        FROM TB_PRODUCT A
        WHERE A.ACTIVE = TRUE
        ORDER BY CREATED_AT DESC
        OFFSET #{pageable.offset} ROWS FETCH NEXT #{pageable.pageSize} ROWS ONLY;
    </select>

    <select id="findProductBySearch" resultMap="productAllResultMap" parameterType="java.util.Map">
        SELECT
              A.PROD_ID
            , A.PROD_NAME
            , A.PROD_SER_NO
            , A.PROD_COST
            , A.PROD_STCK
            FROM TB_PRODUCT A
            WHERE A.ACTIVE = TRUE
        <if test="productSearchRequestDTO.id != null">
            AND A.PROD_ID LIKE #{productSearchRequestDTO.id}
        </if>
        <if test="productSearchRequestDTO.name != null">
            AND A.PROD_NAME LIKE #{productSearchRequestDTO.name}
        </if>
        <if test="productSearchRequestDTO.serialNumber != null">
            AND A.PROD_SER_NO LIKE #{productSearchRequestDTO.serialNumber}
        </if>
        ORDER BY A.CREATED_AT DESC
        OFFSET #{pageable.offset} ROWS FETCH NEXT #{pageable.pageSize} ROWS ONLY;
    </select>

    <select id="findProductCount" resultType="int">
        SELECT
        COUNT(*) AS CNT
        FROM TB_PRODUCT A
        WHERE A.ACTIVE = TRUE;
    </select>

    <select id="findProductBySearchCount" resultType="int" parameterType="java.util.Map">
        SELECT
        COUNT(*) AS CNT
        FROM TB_PRODUCT A
        WHERE A.ACTIVE = TRUE
        <if test="productSearchRequestDTO.id != null">
            AND A.PROD_ID like #{productSearchRequestDTO.id}
        </if>
        <if test="productSearchRequestDTO.name != null">
            AND A.PROD_NAME like #{productSearchRequestDTO.name}
        </if>
        <if test="productSearchRequestDTO.serialNumber != null">
            AND A.PROD_SER_NO like #{productSearchRequestDTO.serialNumber}
        </if>
    </select>

</mapper>