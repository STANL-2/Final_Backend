<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="stanl_2.final_backend.domain.customer.query.repository.CustomerMapper">

    <resultMap id="Customer" type="stanl_2.final_backend.domain.customer.query.dto.CustomerDTO">
        <id property="customerId" column="CUST_ID"/>
        <result property="name" column="CUST_NAME"/>
        <result property="age" column="CUST_AGE"/>
        <result property="sex" column="CUST_SEX"/>
        <result property="phone" column="CUST_PHO"/>
        <result property="emergePhone" column="CUST_EMER_PHO"/>
        <result property="email" column="CUST_EMA"/>
        <result property="memberId" column="MEM_ID"/>
        <result property="active" column="ACTIVE"/>
        <result property="createdAt" column="CREATED_AT"/>
        <result property="updatedAt" column="UPDATED_AT"/>
        <result property="deletedAt" column="DELETED_AT"/>
    </resultMap>

    <resultMap id="SearchCustomer" type="stanl_2.final_backend.domain.customer.query.dto.CustomerSearchDTO">
        <id property="customerId" column="CUST_ID"/>
        <result property="name" column="CUST_NAME"/>
        <result property="sex" column="CUST_SEX"/>
        <result property="phone" column="CUST_PHO"/>
    </resultMap>

    <select id="selectCustomerInfoById" resultMap="Customer" parameterType="String">
        SELECT
               A.CUST_ID,
               A.CUST_NAME,
               A.CUST_AGE,
               A.CUST_SEX,
               A.CUST_PHO,
               A.CUST_EMER_PHO,
               A.CUST_EMA,
               A.MEM_ID,
               A.ACTIVE,
               A.CREATED_AT,
               A.UPDATED_AT,
               A.DELETED_AT
          FROM TB_CUSTOMER_INFO A
         WHERE A.CUST_ID = #{ customerId }
    </select>

    <select id="selectCustomerList" resultMap="Customer" parameterType="_int">
        SELECT
               A.CUST_ID,
               A.CUST_NAME,
               A.CUST_AGE,
               A.CUST_SEX,
               A.CUST_PHO,
               A.CUST_EMER_PHO,
               A.CUST_EMA,
               A.MEM_ID,
               A.ACTIVE,
               A.CREATED_AT,
               A.UPDATED_AT,
               A.DELETED_AT
          FROM TB_CUSTOMER_INFO A
         LIMIT #{ size } OFFSET #{ offset }
    </select>
    
    <select id="selectCustomerCount" resultType="_int">
        SELECT
               COUNT(*)
          FROM TB_CUSTOMER_INFO A
         WHERE A.ACTIVE != 'false';
    </select>

    <select id="findCustomerByConditions" resultMap="SearchCustomer" parameterType="map">
        SELECT
               A.CUST_ID,
               A.CUST_NAME,
               A.CUST_SEX,
               A.CUST_PHO
          FROM TB_CUSTOMER_INFO A
        <where>
            A.ACTIVE != 'false'
            <if test="name != null">
                AND A.CUST_NAME LIKE CONCAT('%', #{ name }, '%')
            </if>
            <if test="sex != null">
                AND A.CUST_SEX = #{ sex }
            </if>
            <if test="phone != null">
                AND A.CUST_PHO = #{ phone }
            </if>
        </where>
        ORDER BY A.CREATED_AT DESC
        LIMIT #{ size } OFFSET #{ offset }
    </select>


    <select id="findCustomerCnt" resultType="_int" parameterType="map">
        SELECT
        COUNT(*) AS CNT
          FROM TB_CUSTOMER_INFO A
        <where>
            A.ACTIVE != 'false'
            <if test="name != null">
                AND A.CUST_NAME = #{name}
            </if>
            <if test="sex != null">
                AND A.CUST_SEX = #{sex}
            </if>
            <if test="phone != null">
                AND A.CUST_PHO = #{phone}
            </if>
        </where>
    </select>

</mapper>